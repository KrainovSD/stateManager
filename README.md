# State Manager

Простоe приложение React/TypeScript для работы с Todo заметками, демонстрирующее работу самописного стейт менеджера.

<br>

# Start

```
npm start - dev mode
npm run build - production
```

<br>

# Instruction

## Создания экземпляра хранилища

Для создание экземпляра хранилища, необходимо импортировать функцию createStore.

```TypeScript
import { createStore } from "../../KRStore";
```

Функция принимает объект настроек, которые содержат:

- Первоначальное состояние хранилища.
- Объект методов, которые будут это состояние изменять.

```JavaScript
const store = createStore({
  initialState : {
    count: 1
  },
  reducers: {
    increment: (state, payload) => {
        state.count = state.count + payload;
        return state;
    }
  }
  })
```

Методы принимают:

- обязательный параметр state (состояние хранилища), который изменяется внутри функции и <strong>возвращается</strong>.
- необязательный параметр payload, который в последствии будет принимать <strong>сгенерированный на основе методов callback</strong> (если payload указан).

Функция создания экземпляра хранилища возвращает объект, который содержит следующие поля:

- sub - функция, которая принимает две callback функции и возвращает id подписки. Обе функции должны иметь обязательный аргумент state, куда будет записан обновленный state через reducer. Первый callback отработает, если переменные возращаемые из второго для prevState и state будут отличаться. Таким образом можно установить слежение не за всем объектом состояния, а за конкретным свойством.

```JavaScript
store.sub(callback , config)
store.sub(
    (state) => {
        console.log(state)
    },
    (state) => {
         return condition? state : state[field]
    }
)
```

- unSub - функция принимающая id подписки для прекращения слежения, созданнного через sub
- reducers - зеркальный объект, который принимался при создании экземпляра, с тем же набором ключей для методов (которые создавались пользователем), но обработанными и измененными callback функциями внутри ключей.
- state - объект содержащий поле current, внутри которого хранится ссылка на копию состояния хранилища.

<br>

## Работа в функциональных компонентах React

Для работы с состоянием внутри функциональных компонентов используется hook useSelector.

```TypeScript
import { useSelector } from "../../../../../KRStore";
const [todos, reducers] = useSelector<ITodo[]>(todoStore, "todo");
```

Hook принимает следующие параметры:

- обязательный параметр store, полученный при создании экземпляра хранилища
- необязательный параметр, который указывает за каким свойством в хранилище мы будем вести наблюдение. Если параметр не передан, то наблюдать будем за всем объектом initialState.

Hook возвращает массив с состоянием хранилища и списком reducers, которые изменяют состояние.

```TypeScript
reducers.increment(2);
```
